import React, { useState, useEffect, useRef } from 'react';
import { Terminal, Cpu, Code, Save, Share2, Layers, Wifi, Power, Battery, Disc, Filter } from 'lucide-react';

const Portfolio = () => {
  const [bootStep, setBootStep] = useState(0);
  const [activeTab, setActiveTab] = useState('MAIN');
  const [projectCategory, setProjectCategory] = useState('ALL');
  const [command, setCommand] = useState('');
  const [cursorVisible, setCursorVisible] = useState(true);
  const bottomRef = useRef(null);

  // Boot sequence logic
  useEffect(() => {
    const timers = [
      setTimeout(() => setBootStep(1), 500),  // BIOS info
      setTimeout(() => setBootStep(2), 1500), // Memory Test
      setTimeout(() => setBootStep(3), 2500), // Device Check
      setTimeout(() => setBootStep(4), 3500), // Loading Kernel
      setTimeout(() => setBootStep(5), 4500), // Complete
    ];
    return () => timers.forEach(clearTimeout);
  }, []);

  // Cursor blink
  useEffect(() => {
    const interval = setInterval(() => {
      setCursorVisible(v => !v);
    }, 500);
    return () => clearInterval(interval);
  }, []);

  // Auto-scroll to bottom of "terminal" when content changes
  useEffect(() => {
    if (bottomRef.current) {
      bottomRef.current.scrollIntoView({ behavior: 'smooth' });
    }
  }, [activeTab, projectCategory]);

  const projects = [
    {
      id: 'PROJ_01',
      name: 'NEON_VANGUARD',
      type: 'FPS_PROTOTYPE',
      engine: 'UE5.3',
      lang: 'C++ / BLUEPRINT',
      desc: 'High-octane movement shooter featuring custom character movement component and replication for 16 players.',
      status: 'COMPILED'
    },
    {
      id: 'PROJ_02',
      name: 'VOID_SHADER',
      type: 'TECH_ART',
      engine: 'UE5.1',
      lang: 'HLSL / MATERIAL GRAPH',
      desc: 'Volumetric raymarching shader implementation for rendering non-euclidean geometry in real-time.',
      status: 'EXPERIMENTAL'
    },
    {
      id: 'PROJ_03',
      name: 'AI_SWARM_SYS',
      type: 'PLUGIN',
      engine: 'UE4.27',
      lang: 'C++',
      desc: 'Multithreaded flocking simulation using ECS pattern. Optimization target: 5000 units @ 60fps.',
      status: 'RELEASED'
    },
    {
      id: 'PROJ_04',
      name: 'MECH_UNIT_09',
      type: '3D_MODEL',
      engine: 'BLENDER',
      lang: '.FBX / PBR',
      desc: 'Low-poly hard surface mech model rigged for UE5 Control Rig. 20k tris, 2x 4k texture sets.',
      status: 'RIGGED'
    },
    {
      id: 'PROJ_05',
      name: 'INTERFACE_PACK',
      type: 'PIXEL_ART',
      engine: 'ASEPRITE',
      lang: '.PNG / SPRITES',
      desc: 'Cyberpunk UI asset pack containing over 200 hand-drawn pixel art elements for HUDs and menus.',
      status: 'PUBLISHED'
    },
    {
      id: 'PROJ_06',
      name: 'SYNTH_HORIZON',
      type: 'MUSIC',
      engine: 'FL STUDIO',
      lang: '.WAV / .CUE',
      desc: 'Adaptive soundtrack system logic + 5 original synthwave tracks. Includes vertical layering setup.',
      status: 'MASTERED'
    }
  ];

  const renderBootScreen = () => (
    <div className="flex flex-col h-full justify-start p-8 font-mono text-sm md:text-base leading-relaxed text-orange-500">
      <div className="mb-4">BIOS DATE 01/18/98 14:22:51 VER 1.02</div>
      <div className="mb-4">CPU: INTEL 486 DX2-66<br/>SPEED: 66 MHz</div>
      
      {bootStep >= 1 && (
        <div className="mb-4">
          MEMORY TEST : 640K OK<br/>
          EXTENDED    : 65536K OK
        </div>
      )}
      
      {bootStep >= 2 && (
        <div className="mb-4">
          DETECTING PRIMARY MASTER ... UE_DEV_DRIVE_C<br/>
          DETECTING PRIMARY SLAVE  ... NONE<br/>
          DETECTING SECONDARY MASTER ... CD-ROM
        </div>
      )}

      {bootStep >= 3 && (
        <div className="mb-4">
          INITIALIZING VIDEO ADAPTER...<br/>
          VRAM: 4MB<br/>
          MODE: 640x480 MONOCHROME (AMBER)
        </div>
      )}

      {bootStep >= 4 && (
        <div className="mt-8 animate-pulse">
          LOADING KERNEL...<br/>
          MOUNTING FILESYSTEM...<br/>
          SYSTEM READY.
        </div>
      )}
    </div>
  );

  const renderNav = () => (
    <div className="border-b-2 border-orange-500 p-2 flex flex-wrap gap-4 text-sm md:text-base bg-black z-10 sticky top-0">
      {['MAIN', 'PROJECTS', 'SKILLS', 'LOGS'].map((tab) => (
        <button
          key={tab}
          onClick={() => setActiveTab(tab)}
          className={`px-3 py-1 font-bold uppercase tracking-wider transition-all duration-75
            ${activeTab === tab 
              ? 'bg-orange-500 text-black hover:bg-orange-400' 
              : 'bg-black text-orange-500 hover:bg-orange-500 hover:text-black border border-transparent hover:border-orange-500'
            }`}
        >
          [{tab}]
        </button>
      ))}
    </div>
  );

  const renderContent = () => {
    switch (activeTab) {
      case 'MAIN':
        return (
          <div className="space-y-6 animate-in fade-in slide-in-from-bottom-2 duration-300 text-orange-500">
            <div className="border-2 border-orange-500 p-6 relative">
              <div className="absolute -top-3 left-4 bg-black text-orange-500 px-2 font-bold">IDENTITY</div>
              <pre className="font-mono text-xs md:text-sm whitespace-pre-wrap overflow-hidden text-orange-500">
{`
   __  __  _   _  ____   _____     _    _     
  |  \\/  || | | ||  _ \\ | ____|   | |  | |    
  | |\\/| || | | || |_) ||  _|     | |  | |    
  | |  | || |_| ||  _ < | |___    |_|  |_|    
  |_|  |_| \\___/ |_| \\_\\|_____|   (_)  (_)    
`}
              </pre>
              <div className="mt-4 space-y-2 text-orange-500">
                <p>ROLE: SENIOR GAMEPLAY ENGINEER</p>
                <p>SPECIALTY: UNREAL ENGINE / C++ / REPLICATION</p>
                <p>LOCATION: REMOTE_NODE_01</p>
                <p>STATUS: <span className="animate-pulse bg-orange-500 text-black px-1">ONLINE</span></p>
              </div>
            </div>

            <div className="border border-dashed border-orange-500/50 p-4">
              <h3 className="text-xl font-bold mb-2 flex items-center gap-2 text-orange-500">
                <Terminal size={20} /> MISSION_STATEMENT
              </h3>
              <p className="leading-relaxed opacity-90 text-orange-400">
                I build systems that don't break. Specializing in high-performance C++ architecture for Unreal Engine 4 & 5. 
                From complex replication graphs to low-level memory management, I ensure the frame rate stays high and the latency stays low.
              </p>
            </div>
            
            <div className="grid grid-cols-2 gap-4">
              <div className="border border-orange-500 p-4 hover:bg-orange-500 hover:text-black transition-colors cursor-default text-orange-500">
                <div className="text-2xl font-bold">5+</div>
                <div className="text-xs uppercase">Years XP</div>
              </div>
              <div className="border border-orange-500 p-4 hover:bg-orange-500 hover:text-black transition-colors cursor-default text-orange-500">
                <div className="text-2xl font-bold">3</div>
                <div className="text-xs uppercase">Shipped Titles</div>
              </div>
            </div>
          </div>
        );

      case 'PROJECTS':
        const categories = ['ALL', 'CODE', 'ART', 'AUDIO'];
        
        const filteredProjects = projects.filter(p => {
            if (projectCategory === 'ALL') return true;
            if (projectCategory === 'CODE') return ['FPS_PROTOTYPE', 'PLUGIN'].includes(p.type);
            if (projectCategory === 'ART') return ['TECH_ART', '3D_MODEL', 'PIXEL_ART'].includes(p.type);
            if (projectCategory === 'AUDIO') return ['MUSIC'].includes(p.type);
            return true;
        });

        return (
          <div className="space-y-6 animate-in fade-in duration-300">
             {/* Sub-navigation for Projects */}
             <div className="flex flex-wrap gap-4 border-b border-orange-900 pb-4 mb-4 items-center">
                <div className="flex items-center gap-2 mr-2 text-orange-700">
                    <Filter size={16} />
                    <span className="text-xs hidden md:inline">FILTER:</span>
                </div>
                {categories.map(cat => (
                    <button 
                        key={cat}
                        onClick={() => setProjectCategory(cat)}
                        className={`text-xs md:text-sm font-bold px-3 py-1 border transition-all duration-200
                        ${projectCategory === cat 
                            ? 'bg-orange-500 text-black border-orange-500' 
                            : 'bg-black text-orange-700 border-orange-900 hover:border-orange-500 hover:text-orange-500'}`}
                    >
                        {cat}
                    </button>
                ))}
             </div>

            <div className="space-y-8">
              {filteredProjects.map((p, i) => (
                <div key={p.id} className="group relative border-2 border-orange-500 p-4 hover:bg-neutral-900 transition-colors">
                  <div className="absolute top-0 right-0 bg-orange-500 text-black text-xs px-2 py-1 font-bold">
                    DIR_ENTRY_{String(i + 1).padStart(2, '0')}
                  </div>
                  <div className="flex flex-col md:flex-row gap-6">
                    {/* ASCII "Thumbnail" */}
                    <div className="w-full md:w-48 h-32 border border-orange-900 flex items-center justify-center bg-black overflow-hidden select-none text-orange-500">
                       <pre className="text-[0.6rem] leading-[0.6rem] opacity-75">
  {(() => {
    switch(p.type) {
      case 'FPS_PROTOTYPE': return `
        +--+
       /   |
    +-+    |
    | |    +--+
    | |       |
    +-+-------+`;
      case 'TECH_ART': return `
      .   * .
    * .   *
   .  * .  *
    * .   *
      .   * .`;
      case '3D_MODEL': return `
        /\\
       |  |
       |  |
      -====-
        ||`;
      case 'PIXEL_ART': return `
    [..]  [..]
    [..]  [..]
    [........]
    [..]  [..]`;
      case 'MUSIC': return `
     | |   |
    ||||| |||
   |||||||||||
    ||||| |||
     | |   |`;
      default: return `
   [SYS]
   [OK]
   [RUN]`;
    }
  })()}
                       </pre>
                    </div>
                    
                    <div className="flex-1 space-y-2 text-orange-500">
                      <h3 className="text-xl font-bold underline decoration-orange-700 decoration-2 underline-offset-4 text-orange-400">{p.name}</h3>
                      <div className="flex flex-wrap gap-2 text-xs">
                        <span className="bg-orange-500 text-black px-1">{p.engine}</span>
                        <span className="border border-orange-500 text-orange-500 px-1">{p.lang}</span>
                        <span className="border border-orange-500 text-orange-500 px-1">{p.status}</span>
                      </div>
                      <p className="text-sm mt-2 font-medium text-orange-300">{p.desc}</p>
                      <div className="pt-2">
                        <button className="text-xs uppercase hover:underline flex items-center gap-1 group-hover:translate-x-1 transition-transform text-orange-500 font-bold">
                          {'>'} EXECUTE_DEMO.EXE
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              ))}
              
              {filteredProjects.length === 0 && (
                <div className="h-32 flex items-center justify-center border border-dashed border-orange-900 text-orange-700">
                    <span className="animate-pulse">ERROR_404: SECTOR_EMPTY</span>
                </div>
              )}
            </div>
          </div>
        );

      case 'SKILLS':
        const skills = [
          { name: 'C++', level: 95 },
          { name: 'Unreal Engine 5', level: 90 },
          { name: 'Blueprints', level: 95 },
          { name: 'Python (Tooling)', level: 75 },
          { name: 'HLSL / Shaders', level: 60 },
          { name: 'Networking/Rep', level: 85 },
        ];
        return (
          <div className="grid md:grid-cols-2 gap-8 animate-in fade-in duration-300 text-orange-500">
            <div className="border border-orange-500 p-4">
              <h3 className="font-bold mb-4 border-b border-orange-900 pb-2 flex items-center gap-2">
                <Code size={16}/> LANGUAGE_STACK
              </h3>
              <div className="space-y-4">
                {skills.map(s => (
                  <div key={s.name}>
                    <div className="flex justify-between text-xs mb-1 font-bold">
                      <span>{s.name.toUpperCase()}</span>
                      <span>[{s.level}%]</span>
                    </div>
                    <div className="h-3 w-full border border-orange-900 p-[2px]">
                      <div 
                        className="h-full bg-orange-500 pattern-checkered"
                        style={{ width: `${s.level}%` }}
                      ></div>
                    </div>
                  </div>
                ))}
              </div>
            </div>

            <div className="border border-orange-500 p-4">
               <h3 className="font-bold mb-4 border-b border-orange-900 pb-2 flex items-center gap-2">
                <Cpu size={16}/> ENGINE_MODULES
              </h3>
              <ul className="space-y-2 text-sm list-none font-medium">
                <li className="flex items-center gap-2"><div className="w-2 h-2 bg-orange-500"></div> Gameplay Ability System (GAS)</li>
                <li className="flex items-center gap-2"><div className="w-2 h-2 bg-orange-500"></div> Slate UI Framework</li>
                <li className="flex items-center gap-2"><div className="w-2 h-2 bg-orange-500"></div> AI Behavior Trees / EQS</li>
                <li className="flex items-center gap-2"><div className="w-2 h-2 bg-orange-500"></div> Chaos Physics</li>
                <li className="flex items-center gap-2"><div className="w-2 h-2 bg-orange-500"></div> Custom Movement Components</li>
              </ul>
            </div>
          </div>
        );

      case 'LOGS':
        return (
          <div className="font-mono text-xs md:text-sm animate-in fade-in duration-300">
            <div className="mb-4 text-orange-700 border-b border-orange-900 pb-2">
              SYSTEM_LOGS // LATEST_COMMITS
            </div>
            <div className="space-y-3 text-orange-400">
               <div className="flex gap-4">
                <span className="text-orange-700">[2024-01-15 09:42]</span>
                <span>Refactored inventory replication logic. Optimized network bandwidth.</span>
               </div>
               <div className="flex gap-4">
                <span className="text-orange-700">[2024-01-12 14:20]</span>
                <span>Fixed null pointer exception in AI controller.</span>
               </div>
               <div className="flex gap-4">
                <span className="text-orange-700">[2024-01-10 18:01]</span>
                <span>Initial commit for procedural dungeon generator plugin.</span>
               </div>
               <div className="flex gap-4">
                <span className="text-orange-700">[2023-12-28 11:15]</span>
                <span>Shader compilation finished (4,203 shaders).</span>
               </div>
            </div>
            
            <div className="mt-8 border-t-2 border-dashed border-orange-900 pt-8 text-orange-500">
              <h3 className="text-lg font-bold mb-4">CONTACT_CHANNELS</h3>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                 <a href="#" className="border border-orange-500 p-3 flex items-center gap-3 hover:bg-orange-500 hover:text-black transition-colors">
                    <Wifi size={16} /> 
                    <span>GITHUB.COM/USER</span>
                 </a>
                 <a href="#" className="border border-orange-500 p-3 flex items-center gap-3 hover:bg-orange-500 hover:text-black transition-colors">
                    <Share2 size={16} /> 
                    <span>LINKEDIN_CONNECTION</span>
                 </a>
                 <div className="border border-orange-500 p-3 flex items-center gap-3 hover:bg-orange-500 hover:text-black transition-colors cursor-pointer" onClick={() => {
                   navigator.clipboard.writeText("dev@example.com");
                   setCommand("COPIED TO CLIPBOARD");
                 }}>
                    <Save size={16} /> 
                    <span>COPY_EMAIL_ADDRESS</span>
                 </div>
              </div>
            </div>
          </div>
        );
      default:
        return null;
    }
  };

  if (bootStep < 5) {
    return (
      <div className="min-h-screen bg-black text-orange-500 font-mono p-4 flex flex-col items-center justify-center relative overflow-hidden">
        {/* CRT Effects */}
        <div className="pointer-events-none fixed inset-0 z-50 bg-[linear-gradient(rgba(18,16,16,0)_50%,rgba(0,0,0,0.25)_50%),linear-gradient(90deg,rgba(255,0,0,0.06),rgba(0,255,0,0.02),rgba(0,0,255,0.06))] bg-[length:100%_4px,3px_100%] pointer-events-none" />
        <div className="pointer-events-none fixed inset-0 z-40 bg-[radial-gradient(circle_at_center,transparent_50%,rgba(0,0,0,0.4)_100%)]" />
        
        <div className="w-full max-w-3xl h-[60vh] border-2 border-orange-500 p-1 relative shadow-[0_0_20px_rgba(255,165,0,0.2)]">
            <div className="absolute inset-0 bg-black opacity-90 p-4">
                {renderBootScreen()}
            </div>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-neutral-900 text-orange-500 font-mono p-2 md:p-8 flex flex-col items-center relative selection:bg-orange-500 selection:text-black overflow-x-hidden">
      
      {/* CRT Scanlines & Vignette */}
      <div className="pointer-events-none fixed inset-0 z-50 mix-blend-overlay opacity-20 bg-[url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0IiBoZWlnaHQ9IjQiPgo8cmVjdCB3aWR0aD0iNCIgaGVpZ2h0PSI0IiBmaWxsPSIjZmZmIi8+CjxyZWN0IHdpZHRoPSI0IiBoZWlnaHQ9IjEiIGZpbGw9IiMwMDAiLz4KPC9zdmc+')] pointer-events-none" />
      <div className="pointer-events-none fixed inset-0 z-40 bg-[radial-gradient(circle_at_center,transparent_60%,rgba(0,0,0,0.6)_100%)]" />

      {/* Main Container */}
      <div className="w-full max-w-4xl min-h-[85vh] border-4 border-orange-500 bg-black relative shadow-[0_0_15px_rgba(255,165,0,0.15)] flex flex-col">
        
        {/* Header Bar */}
        <div className="bg-orange-500 text-black px-2 py-1 flex justify-between items-center text-xs md:text-sm font-bold uppercase tracking-widest select-none">
           <div className="flex items-center gap-2">
             <Layers size={14} />
             <span>UNREAL_DEV_OS v9.8</span>
           </div>
           <div className="flex gap-4">
              <span className="hidden md:inline">MEM: 64MB OK</span>
              <div className="flex items-center gap-1"><Battery size={14}/> 100%</div>
           </div>
        </div>

        {/* Navigation */}
        {renderNav()}

        {/* Main Viewport */}
        <div className="flex-1 p-4 md:p-8 overflow-y-auto relative custom-scrollbar">
           {renderContent()}
           <div ref={bottomRef} />
        </div>

        {/* Footer Command Line */}
        <div className="border-t-2 border-orange-500 p-2 bg-black text-sm uppercase flex flex-col md:flex-row gap-2">
          <div className="flex-1 flex items-center gap-2">
             <span className="text-orange-500 select-none">{`C:\\USERS\\DEV\\${activeTab}>`}</span>
             <input 
                type="text" 
                value={command}
                onChange={(e) => setCommand(e.target.value.toUpperCase())}
                className="bg-transparent border-none outline-none flex-1 text-orange-500 placeholder-orange-800 font-bold caret-orange-500"
                placeholder="TYPE COMMAND..."
                autoFocus
             />
          </div>
          <div className="hidden md:flex gap-4 text-xs text-orange-700 items-center select-none">
             <span>INS: OVR</span>
             <span>Ln 42, Col 12</span>
             <span><Disc size={12} className="inline mr-1 animate-pulse text-orange-500"/>REC</span>
          </div>
        </div>
      </div>

      <div className="mt-4 text-xs text-orange-800 font-mono">
        PRESS ANY KEY TO CONTINUE _ {cursorVisible ? 'â–ˆ' : ' '}
      </div>

      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=VT323&family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap');
        
        body {
          font-family: 'Space Mono', monospace;
        }

        .custom-scrollbar::-webkit-scrollbar {
          width: 12px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
          background: #000;
          border-left: 1px solid #333;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
          background: #f97316;
          border: 2px solid #000;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
          background: #ea580c;
        }

        .pattern-checkered {
            background-image: 
              linear-gradient(45deg, #000 25%, transparent 25%), 
              linear-gradient(-45deg, #000 25%, transparent 25%), 
              linear-gradient(45deg, transparent 75%, #000 75%), 
              linear-gradient(-45deg, transparent 75%, #000 75%);
            background-size: 4px 4px;
            background-position: 0 0, 0 2px, 2px -2px, -2px 0px;
        }
      `}</style>
    </div>
  );
};

export default Portfolio;